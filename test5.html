<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ことばあそび Ver1.32</title>
    <style>
        :root { --g-blue: #4285F4; --g-red: #EA4335; --g-yellow: #FBBC05; --g-green: #34A853; }
        
        html, body { 
            overflow: hidden; height: 100%; position: fixed; width: 100%;
            background: #202124; margin: 0; display: flex; flex-direction: column; align-items: center; 
        }

        #debug-panel { color: #ccc; font-size: 0.7rem; width: 100%; padding: 10px; z-index: 100; }
        .hidden { display: none !important; }

        #mobile-stage { 
            width: 100vw; max-width: 375px; height: 100vh; max-height: 812px;
            background: radial-gradient(circle, #ffffff 0%, #f0f0f0 100%);
            position: relative; overflow: hidden;
            border: 8px solid;
            border-image: linear-gradient(to bottom, var(--g-blue), var(--g-red), var(--g-yellow), var(--g-green)) 1;
            display: flex; flex-direction: column;
        }

        /* じじエリア（20%） */
        .area-jiji { flex: 2; background: var(--g-blue); display: flex; flex-direction: column; align-items: center; padding-top: 15px; }
        /* 中央エリア（35%） */
        .area-mid { flex: 3.5; position: relative; display: flex; align-items: center; justify-content: center; }
        /* 凱士エリア（45%） */
        .area-kaito { flex: 4.5; background: var(--g-yellow); display: flex; flex-direction: column; align-items: center; justify-content: flex-end; padding-bottom: 15px; }

        .icon { width: 55px; height: 55px; border-radius: 50%; border: 3px solid white; background: white; overflow: hidden; }

        /* カードの基本設定 */
        .hand-grid { display: flex; gap: 5px; justify-content: center; width: 100%; padding: 10px 0; }
        
        .card { 
            background: white; border: 1px solid #ddd; border-radius: 6px; 
            display: flex; align-items: center; justify-content: center; 
            font-weight: bold; box-shadow: 1px 1px 5px rgba(0,0,0,0.1);
            transition: all 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        /* じじカード：さらに小さく */
        .jiji-card { width: 30px; height: 45px; font-size: 0.8rem; }
        /* 凱士カード：大きく（9文字並ぶよう調整） */
        .kaito-card { width: 36px; height: 55px; font-size: 1.2rem; cursor: pointer; }

        /* 中央に出た時のスタイル */
        .played-jiji { transform: scale(2.5) rotate(180deg) !important; z-index: 10; position: absolute !important; }
        .played-kaito { transform: scale(0.8) !important; z-index: 11; position: absolute !important; }

        #qr-area { text-align: center; background: white; padding: 5px; border-radius: 5px; display: inline-block; }
        .btn { cursor: pointer; padding: 8px 15px; background: white; border-radius: 20px; font-weight: bold; border: none; font-size: 0.8rem; }
    </style>
</head>
<body>

    <div id="debug-panel">
        <span>Ver: 1.32</span> 
        <input id="debug-cb" type="checkbox" onchange="toggleDebug()"> OFF
        <button id="deal-btn" class="btn" onclick="dealCards()">カードを配る</button>
        <div id="qr-wrap" style="margin-top:5px;"><div id="qr-area"></div></div>
    </div>

    <div id="mobile-stage">
        <div class="area-jiji">
            <div class="icon"><img src="https://api.dicebear.com/7.x/bottts/svg?seed=jiji" width="100%"></div>
            <div id="jiji-hand" class="hand-grid"></div>
        </div>

        <div id="center-stage" class="area-mid">
            <div style="color:#ccc; font-size:0.8rem;">ここにカードを出す</div>
        </div>

        <div class="area-kaito">
            <div id="kaito-hand" class="hand-grid"></div>
            <div class="icon"><img src="https://api.dicebear.com/7.x/adventurer/svg?seed=kaito" width="100%"></div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <script>
        function toggleDebug() {
            if(document.getElementById('debug-cb').checked) {
                document.getElementById('debug-panel').classList.add('hidden');
            }
        }

        // QRコード生成（ライブラリ使用で見やすく）
        new QRCode(document.getElementById("qr-area"), { text: window.location.href, width: 70, height: 70 });

        async function dealCards() {
            const btn = document.getElementById('deal-btn');
            btn.innerText = "もう一回";
            
            const kHand = document.getElementById('kaito-hand');
            const jHand = document.getElementById('jiji-hand');
            const center = document.getElementById('center-stage');
            kHand.innerHTML = jHand.innerHTML = '';
            center.innerHTML = '';

            const word = "トイレットペーパー";
            const chars = word.split('').reverse(); // 右から配るため反転

            for(let i = 0; i < chars.length; i++) {
                // 凱士に配る
                await createCard(kHand, chars[i], 'card kaito-card', i, true);
                // じじに配る（裏向き・空）
                await createCard(jHand, '', 'card jiji-card', i, false);
            }
        }

        function createCard(container, txt, className, i, isKaito) {
            return new Promise(resolve => {
                setTimeout(() => {
                    const c = document.createElement('div');
                    c.className = className;
                    c.innerText = txt;
                    c.style.opacity = '0';
                    c.style.transform = 'translateY(20px)';
                    container.insertBefore(c, container.firstChild);
                    
                    if(isKaito) c.onclick = () => playCard(c, true);

                    setTimeout(() => {
                        c.style.opacity = '1';
                        c.style.transform = 'translateY(0)';
                        resolve();
                    }, 50);
                }, 150);
            });
        }

        function playCard(cardElem, isKaito) {
            const center = document.getElementById('center-stage');
            const newPos = isKaito ? 'played-kaito' : 'played-jiji';
            
            // 中央へ移動させる演出（簡易版）
            cardElem.classList.add(newPos);
            center.appendChild(cardElem);
            
            // もし凱士が出したら、じじも1秒後にランダムで1枚出す演出（ロジック試作）
            if(isKaito) {
                setTimeout(() => {
                    const jCards = document.querySelectorAll('.jiji-card');
                    if(jCards.length > 0) {
                        const randomIdx = Math.floor(Math.random() * jCards.length);
                        const jCard = jCards[randomIdx];
                        jCard.innerText = "？"; // じじの回答
                        jCard.classList.add('played-jiji');
                        center.appendChild(jCard);
                    }
                }, 1000);
            }
        }
    </script>
</body>
</html>
